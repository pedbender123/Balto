FROM python:3.10-slim

# Install system dependencies for psycopg2 and others
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /backend

# Install lightweight dependencies
COPY requirements-stress.txt .
RUN pip install --no-cache-dir -r requirements-stress.txt

# Copy application code
COPY . .

# Setup user
RUN useradd -m -u 1000 balto_user && \
    chown -R balto_user:balto_user /backend

USER balto_user

EXPOSE 8000
