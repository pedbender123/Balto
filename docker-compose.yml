services:
  server:
    build: ./backend
    container_name: balto-server-prod
    ports:
      - "8765:8765"
    volumes:
      # Persistência do Banco de Dados
      - balto-dados:/backend/app/dados
      
      # Infraestrutura de Teste (Fase 1): Salvar áudios no host para calibração
      - ./audio_dumps:/backend/app/audio_dumps
      
      # Sincronização de Código e Status (Importante para o Batch UI funcionar)
      - ./backend:/backend
    env_file:
      - ./backend/.env
    restart: unless-stopped
    env_file:
      - ./backend/.env
    restart: unless-stopped
    # Devices removido para evitar erro em VPS sem placa de som
    # devices:
    #   - /dev/snd:/dev/snd

volumes:
  balto-dados: